"use strict";(globalThis.webpackChunkai_robotics_book=globalThis.webpackChunkai_robotics_book||[]).push([[6683],{737:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ch3-ad-c1c756370ddc4b8a204fb8be47aab3a2.svg"},1406:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ch3-flow-e588cd3e08708e3594ca160316239dd4.svg"},6272:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ch3-flow2-9076926b893b8d0a381fc527b44376d9.svg"},6356:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"module1_ros2/services-and-actions","title":"ROS2 Services and Actions","description":"Learning Objectives","source":"@site/docs/module1_ros2/03-services-and-actions.md","sourceDirName":"module1_ros2","slug":"/module1_ros2/services-and-actions","permalink":"/Physical-AI-and-Humanoid-Robotics-Book/docs/module1_ros2/services-and-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/Iqrasajid-01/docs/module1_ros2/03-services-and-actions.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"ROS2 Services and Actions","sidebar_label":"03 - ROS2 Services and Actions"},"sidebar":"tutorialSidebar","previous":{"title":"02 - ROS2 Nodes and Topics","permalink":"/Physical-AI-and-Humanoid-Robotics-Book/docs/module2_simulation/07-introduction-to-gazebo-simulation"},"next":{"title":"04 - ROS2 Packages and Launch Files","permalink":"/Physical-AI-and-Humanoid-Robotics-Book/docs/module1_ros2/ros2-packages-and-launch-files"}}');var r=s(4848),c=s(8453);const l={title:"ROS2 Services and Actions",sidebar_label:"03 - ROS2 Services and Actions"},a="ROS2 Services and Actions",t={},o=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"ROS2 Services",id:"ros2-services",level:3},{value:"Service Types",id:"service-types",level:3},{value:"ROS2 Actions",id:"ros2-actions",level:3},{value:"Architecture Diagram",id:"architecture-diagram",level:2},{value:"Flow Diagram",id:"flow-diagram",level:2},{value:"Code Example: Service Server and Client",id:"code-example-service-server-and-client",level:2},{value:"Code Example: Action Server and Client",id:"code-example-action-server-and-client",level:2},{value:"Custom Service Example",id:"custom-service-example",level:2},{value:"Step-by-Step Practical Tutorial",id:"step-by-step-practical-tutorial",level:2},{value:"Creating a Service Server and Client",id:"creating-a-service-server-and-client",level:3},{value:"Summary",id:"summary",level:2},{value:"Mini-Quiz",id:"mini-quiz",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ros2-services-and-actions",children:"ROS2 Services and Actions"})}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Define ROS2 services and explain their synchronous request-response pattern"}),"\n",(0,r.jsx)(n.li,{children:"Create and implement custom service types"}),"\n",(0,r.jsx)(n.li,{children:"Design efficient service-based communication systems"}),"\n",(0,r.jsx)(n.li,{children:"Understand the differences between services and actions"}),"\n",(0,r.jsx)(n.li,{children:"Implement action servers and clients for long-running tasks"}),"\n",(0,r.jsx)(n.li,{children:"Debug common issues with service and action communication"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"While topics provide asynchronous communication through the publish-subscribe pattern, services and actions provide synchronous and goal-based communication patterns respectively. Services enable request-response interactions, while actions are designed for long-running tasks with feedback and status updates."}),"\n",(0,r.jsx)(n.p,{children:"Services and actions are essential for robotics applications where certain operations require guaranteed delivery and response. For example, requesting the current robot pose, saving a map, or executing a complex navigation task all benefit from these communication patterns."}),"\n",(0,r.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,r.jsx)(n.h3,{id:"ros2-services",children:"ROS2 Services"}),"\n",(0,r.jsx)(n.p,{children:"Services provide a synchronous request-response communication pattern:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A service client sends a request to a service server"}),"\n",(0,r.jsx)(n.li,{children:"The server processes the request and sends back a response"}),"\n",(0,r.jsx)(n.li,{children:"The client waits for the response (blocking call)"}),"\n",(0,r.jsx)(n.li,{children:"Services are ideal for operations that have a clear start and end"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-types",children:"Service Types"}),"\n",(0,r.jsxs)(n.p,{children:["Services are defined using ",(0,r.jsx)(n.code,{children:".srv"})," files that specify:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request message fields"}),"\n",(0,r.jsx)(n.li,{children:"Response message fields"}),"\n",(0,r.jsxs)(n.li,{children:["Separated by a ",(0,r.jsx)(n.code,{children:"---"})," line"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ros2-actions",children:"ROS2 Actions"}),"\n",(0,r.jsx)(n.p,{children:"Actions are designed for long-running tasks and provide:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Goal requests with parameters"}),"\n",(0,r.jsx)(n.li,{children:"Continuous feedback during execution"}),"\n",(0,r.jsx)(n.li,{children:"Result responses upon completion"}),"\n",(0,r.jsx)(n.li,{children:"Ability to cancel ongoing operations"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Actions are ideal for tasks like navigation, manipulation, or calibration that take time and need to report progress."}),"\n",(0,r.jsx)(n.h2,{id:"architecture-diagram",children:"Architecture Diagram"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Architecture Diagram",src:s(737).A+"",width:"1057",height:"241"})}),"\n",(0,r.jsx)(n.h2,{id:"flow-diagram",children:"Flow Diagram"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Architecture Diagram",src:s(1406).A+"",width:"451",height:"327"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Architecture Diagram",src:s(6272).A+"",width:"481",height:"369"})}),"\n",(0,r.jsx)(n.h2,{id:"code-example-service-server-and-client",children:"Code Example: Service Server and Client"}),"\n",(0,r.jsx)(n.p,{children:"Here's an example of a ROS2 service server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass MinimalService(Node):\n\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_service = MinimalService()\n    rclpy.spin(minimal_service)\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.p,{children:"And the corresponding service client:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass MinimalClient(Node):\n\n    def __init__(self):\n        super().__init__('minimal_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, future)\n        return future.result()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_client = MinimalClient()\n    response = minimal_client.send_request(int(sys.argv[1]), int(sys.argv[2]))\n    minimal_client.get_logger().info(\n        'Result of add_two_ints: %d' % response.sum)\n    minimal_client.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"code-example-action-server-and-client",children:"Code Example: Action Server and Client"}),"\n",(0,r.jsx)(n.p,{children:"Action server example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import time\nimport rclpy\nfrom rclpy.action import ActionServer, CancelResponse\nfrom rclpy.node import Node\nfrom rclpy.callback_groups import ReentrantCallbackGroup\nfrom rclpy.executors import MultiThreadedExecutor\n\nfrom custom_interfaces.action import Fibonacci\n\n\nclass FibonacciActionServer(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            execute_callback=self.execute_callback,\n            callback_group=ReentrantCallbackGroup(),\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback)\n\n    def destroy(self):\n        self._action_server.destroy()\n        super().destroy_node()\n\n    def goal_callback(self, goal_request):\n        self.get_logger().info('Received goal request')\n        return rclpy.action.server.GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\n\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Feedback: {feedback_msg.sequence}')\n            time.sleep(1)\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        self.get_logger().info(f'Result: {result.sequence}')\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    fibonacci_action_server = FibonacciActionServer()\n\n    executor = MultiThreadedExecutor()\n    rclpy.spin(fibonacci_action_server, executor=executor)\n\n    fibonacci_action_server.destroy()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"custom-service-example",children:"Custom Service Example"}),"\n",(0,r.jsxs)(n.p,{children:["To create a custom service type, create a ",(0,r.jsx)(n.code,{children:".srv"})," file in your package's ",(0,r.jsx)(n.code,{children:"srv"})," directory:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# CalculateDistance.srv\nfloat64 x1\nfloat64 y1\nfloat64 x2\nfloat64 y2\n---\nfloat64 distance\nstring error_message\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-by-step-practical-tutorial",children:"Step-by-Step Practical Tutorial"}),"\n",(0,r.jsx)(n.h3,{id:"creating-a-service-server-and-client",children:"Creating a Service Server and Client"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create a new ROS2 package"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python my_robot_services\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create the service server"})," (",(0,r.jsx)(n.code,{children:"my_robot_services/my_robot_services/service_server.py"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Use the service server code example above\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Create the service client"})," (",(0,r.jsx)(n.code,{children:"my_robot_services/my_robot_services/service_client.py"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Use the service client code example above\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Make the scripts executable"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chmod +x my_robot_services/my_robot_services/service_server.py\nchmod +x my_robot_services/my_robot_services/service_client.py\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Update the setup.py file"})," to include entry points:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'service_server = my_robot_services.service_server:main',\n        'service_client = my_robot_services.service_client:main',\n    ],\n},\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build the package"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_services\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source the workspace"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Run the service server in one terminal"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_services service_server\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"In another terminal, run the service client"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_services service_client 2 3\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"This chapter explored ROS2 services and actions, which provide synchronous and goal-based communication patterns respectively. Services are ideal for request-response interactions, while actions are designed for long-running tasks that require feedback and cancellation capabilities."}),"\n",(0,r.jsx)(n.p,{children:"Understanding when to use topics, services, or actions is crucial for designing effective robotic systems. Topics for streaming data, services for immediate requests, and actions for complex operations with progress tracking."}),"\n",(0,r.jsx)(n.h2,{id:"mini-quiz",children:"Mini-Quiz"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"What is the main difference between ROS2 services and topics?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Services are faster than topics"}),"\n",(0,r.jsx)(n.li,{children:"B) Services provide synchronous request-response while topics are asynchronous"}),"\n",(0,r.jsx)(n.li,{children:"C) Services use different message types"}),"\n",(0,r.jsx)(n.li,{children:"D) There is no difference"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Which communication pattern is best for a long-running navigation task that needs to provide feedback?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Topic"}),"\n",(0,r.jsx)(n.li,{children:"B) Service"}),"\n",(0,r.jsx)(n.li,{children:"C) Action"}),"\n",(0,r.jsx)(n.li,{children:"D) Parameter"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"What can a ROS2 action provide that a service cannot?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Request and response"}),"\n",(0,r.jsx)(n.li,{children:"B) Feedback during execution"}),"\n",(0,r.jsx)(n.li,{children:"C) Error handling"}),"\n",(0,r.jsx)(n.li,{children:"D) Authentication"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"In a service communication, what happens when the client sends a request?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) The client continues execution immediately"}),"\n",(0,r.jsx)(n.li,{children:"B) The client waits for the response (blocking)"}),"\n",(0,r.jsx)(n.li,{children:"C) The server ignores the request"}),"\n",(0,r.jsx)(n.li,{children:"D) The request is queued indefinitely"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Which of the following can be canceled once started?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A) Service call"}),"\n",(0,r.jsx)(n.li,{children:"B) Topic publishing"}),"\n",(0,r.jsx)(n.li,{children:"C) Action goal"}),"\n",(0,r.jsx)(n.li,{children:"D) Parameter update"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Answers"}),": 1-B, 2-C, 3-B, 4-B, 5-C"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(6540);const r={},c=i.createContext(r);function l(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);