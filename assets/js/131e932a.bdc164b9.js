"use strict";(globalThis.webpackChunkai_robotics_book=globalThis.webpackChunkai_robotics_book||[]).push([[7934],{655:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>m});const s=JSON.parse('{"id":"capstone/capstone-implementation","title":"Chapter 26: Capstone Implementation - Building the Integrated System","description":"Learning Objectives","source":"@site/docs/capstone/26-capstone-implementation.md","sourceDirName":"capstone","slug":"/capstone/capstone-implementation","permalink":"/Physical-AI-and-Humanoid-Robotics-Book/docs/capstone/capstone-implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/Iqrasajid-01/docs/capstone/26-capstone-implementation.md","tags":[],"version":"current","sidebarPosition":26,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 25: Capstone Design - Integrating All Concepts","permalink":"/Physical-AI-and-Humanoid-Robotics-Book/docs/capstone/capstone-design"},"next":{"title":"Chapter 27: Assessment and Validation - Evaluating System Performance","permalink":"/Physical-AI-and-Humanoid-Robotics-Book/docs/assessment/assessment-and-validation"}}');var o=t(4848),r=t(8453);const a={},i="Chapter 26: Capstone Implementation - Building the Integrated System",l={},m=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"1. Implementation Strategy",id:"1-implementation-strategy",level:3},{value:"2. Incremental Integration",id:"2-incremental-integration",level:3},{value:"3. Performance Optimization",id:"3-performance-optimization",level:3},{value:"4. Error Handling and Recovery",id:"4-error-handling-and-recovery",level:3},{value:"Architecture/Flow Diagram",id:"architectureflow-diagram",level:2},{value:"Practical Tutorials",id:"practical-tutorials",level:2},{value:"Tutorial 1: Implementing the Core System Framework",id:"tutorial-1-implementing-the-core-system-framework",level:3},{value:"Tutorial 2: Implementing ROS2 Integration Layer",id:"tutorial-2-implementing-ros2-integration-layer",level:3},{value:"Code Snippets",id:"code-snippets",level:2},{value:"Performance Monitoring and Optimization",id:"performance-monitoring-and-optimization",level:3},{value:"Validation and Testing",id:"validation-and-testing",level:2},{value:"System Integration Testing",id:"system-integration-testing",level:3},{value:"Summary",id:"summary",level:2},{value:"Mini-Quiz",id:"mini-quiz",level:2},{value:"Answers to Mini-Quiz",id:"answers-to-mini-quiz",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"chapter-26-capstone-implementation---building-the-integrated-system",children:"Chapter 26: Capstone Implementation - Building the Integrated System"})}),"\n",(0,o.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Implement the designed capstone system architecture"}),"\n",(0,o.jsx)(n.li,{children:"Integrate ROS2, simulation, Isaac, and VLA components into a working system"}),"\n",(0,o.jsx)(n.li,{children:"Deploy and test the complete integrated robotics system"}),"\n",(0,o.jsx)(n.li,{children:"Troubleshoot and optimize the integrated system performance"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(n.p,{children:"This chapter focuses on the practical implementation of the capstone system designed in the previous chapter. We'll walk through the actual implementation process, addressing real-world challenges that arise when integrating multiple complex systems."}),"\n",(0,o.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,o.jsx)(n.h3,{id:"1-implementation-strategy",children:"1. Implementation Strategy"}),"\n",(0,o.jsx)(n.p,{children:"A systematic approach to implementing the integrated system, considering dependencies and integration points."}),"\n",(0,o.jsx)(n.h3,{id:"2-incremental-integration",children:"2. Incremental Integration"}),"\n",(0,o.jsx)(n.p,{children:"Building and testing the system incrementally to identify and resolve issues early."}),"\n",(0,o.jsx)(n.h3,{id:"3-performance-optimization",children:"3. Performance Optimization"}),"\n",(0,o.jsx)(n.p,{children:"Techniques for optimizing the performance of the integrated system across all modules."}),"\n",(0,o.jsx)(n.h3,{id:"4-error-handling-and-recovery",children:"4. Error Handling and Recovery"}),"\n",(0,o.jsx)(n.p,{children:"Implementing robust error handling and recovery mechanisms for the integrated system."}),"\n",(0,o.jsx)(n.h2,{id:"architectureflow-diagram",children:"Architecture/Flow Diagram"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Flow Diagram",src:t(2177).A+"",width:"1742",height:"781"})}),"\n",(0,o.jsx)(n.h2,{id:"practical-tutorials",children:"Practical Tutorials"}),"\n",(0,o.jsx)(n.h3,{id:"tutorial-1-implementing-the-core-system-framework",children:"Tutorial 1: Implementing the Core System Framework"}),"\n",(0,o.jsx)(n.p,{children:"Let's create the core framework for our integrated system:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import asyncio\nimport json\nimport logging\nfrom typing import Dict, Any, List, Optional, Callable\nfrom dataclasses import dataclass, field\nfrom enum import Enum\nimport threading\nimport time\nimport subprocess\nimport os\n\nclass SystemState(Enum):\n    STOPPED = "stopped"\n    STARTING = "starting"\n    RUNNING = "running"\n    STOPPING = "stopping"\n    ERROR = "error"\n\nclass ModuleType(Enum):\n    ROS2 = "ros2"\n    ISAAC = "isaac"\n    VLA = "vla"\n    SIMULATION = "simulation"\n    HARDWARE = "hardware"\n\n@dataclass\nclass SystemModule:\n    name: str\n    type: ModuleType\n    startup_cmd: str\n    health_check: str\n    dependencies: List[str] = field(default_factory=list)\n    config_file: Optional[str] = None\n\nclass CapstoneSystem:\n    """Implementation of the capstone integrated system."""\n\n    def __init__(self, config_path: str = None):\n        self.config_path = config_path\n        self.modules: Dict[str, SystemModule] = {}\n        self.module_processes: Dict[str, subprocess.Popen] = {}\n        self.state = SystemState.STOPPED\n        self.health_status: Dict[str, bool] = {}\n        self.error_log: List[str] = []\n\n        # Set up logging\n        self.logger = logging.getLogger("CapstoneSystem")\n        handler = logging.StreamHandler()\n        formatter = logging.Formatter(\'%(asctime)s - %(name)s - %(levelname)s - %(message)s\')\n        handler.setFormatter(formatter)\n        self.logger.addHandler(handler)\n        self.logger.setLevel(logging.INFO)\n\n        # Load configuration if provided\n        if config_path:\n            self.load_configuration(config_path)\n\n    def load_configuration(self, config_path: str) -> None:\n        """Load system configuration from file."""\n        try:\n            with open(config_path, \'r\') as f:\n                config = json.load(f)\n\n            for module_name, module_config in config.get(\'modules\', {}).items():\n                module = SystemModule(\n                    name=module_name,\n                    type=ModuleType(module_config[\'type\']),\n                    startup_cmd=module_config[\'startup_cmd\'],\n                    health_check=module_config[\'health_check\'],\n                    dependencies=module_config.get(\'dependencies\', []),\n                    config_file=module_config.get(\'config_file\')\n                )\n                self.modules[module_name] = module\n\n            self.logger.info(f"Configuration loaded from {config_path}")\n        except Exception as e:\n            self.logger.error(f"Failed to load configuration: {e}")\n\n    def add_module(self, module: SystemModule) -> None:\n        """Add a module to the system."""\n        self.modules[module.name] = module\n        self.health_status[module.name] = False\n        self.logger.info(f"Module {module.name} added to system")\n\n    def start_module(self, module_name: str) -> bool:\n        """Start a specific module."""\n        if module_name not in self.modules:\n            self.logger.error(f"Module {module_name} not found")\n            return False\n\n        module = self.modules[module_name]\n\n        try:\n            # Set up environment based on module type\n            env = os.environ.copy()\n            if module.type == ModuleType.ROS2:\n                env[\'ROS_DOMAIN_ID\'] = \'42\'  # Example domain ID\n            elif module.type == ModuleType.ISAAC:\n                env[\'CUDA_VISIBLE_DEVICES\'] = \'0\'  # Use GPU 0\n\n            # Start the module process\n            process = subprocess.Popen(\n                module.startup_cmd.split(),\n                stdout=subprocess.PIPE,\n                stderr=subprocess.PIPE,\n                env=env\n            )\n\n            self.module_processes[module_name] = process\n            self.logger.info(f"Module {module_name} started with PID {process.pid}")\n\n            # Wait briefly to see if process starts successfully\n            time.sleep(2)\n\n            if process.poll() is not None:\n                # Process has already terminated\n                stdout, stderr = process.communicate()\n                self.logger.error(f"Module {module_name} failed to start: {stderr.decode()}")\n                return False\n\n            return True\n\n        except Exception as e:\n            self.logger.error(f"Failed to start module {module_name}: {e}")\n            return False\n\n    def stop_module(self, module_name: str) -> bool:\n        """Stop a specific module."""\n        if module_name not in self.module_processes:\n            self.logger.warning(f"Module {module_name} is not running")\n            return True\n\n        process = self.module_processes[module_name]\n\n        try:\n            process.terminate()\n            try:\n                process.wait(timeout=10)  # Wait up to 10 seconds\n            except subprocess.TimeoutExpired:\n                process.kill()  # Force kill if it doesn\'t stop\n                self.logger.warning(f"Module {module_name} was force killed")\n\n            del self.module_processes[module_name]\n            self.health_status[module_name] = False\n            self.logger.info(f"Module {module_name} stopped")\n            return True\n\n        except Exception as e:\n            self.logger.error(f"Failed to stop module {module_name}: {e}")\n            return False\n\n    def check_health(self, module_name: str) -> bool:\n        """Check the health of a specific module."""\n        if module_name not in self.modules:\n            return False\n\n        module = self.modules[module_name]\n\n        try:\n            result = subprocess.run(\n                module.health_check.split(),\n                capture_output=True,\n                text=True,\n                timeout=5\n            )\n\n            health = result.returncode == 0\n            self.health_status[module_name] = health\n\n            if not health:\n                self.logger.warning(f"Module {module_name} is unhealthy")\n\n            return health\n\n        except subprocess.TimeoutExpired:\n            self.logger.error(f"Health check for {module_name} timed out")\n            self.health_status[module_name] = False\n            return False\n        except Exception as e:\n            self.logger.error(f"Health check failed for {module_name}: {e}")\n            self.health_status[module_name] = False\n            return False\n\n    def start_system(self) -> bool:\n        """Start the entire system following dependency order."""\n        if self.state != SystemState.STOPPED:\n            self.logger.error("System is not in STOPPED state")\n            return False\n\n        self.state = SystemState.STARTING\n        self.logger.info("Starting capstone system...")\n\n        # Determine startup order based on dependencies\n        startup_order = self._determine_startup_order()\n\n        for module_name in startup_order:\n            self.logger.info(f"Starting module: {module_name}")\n\n            if not self.start_module(module_name):\n                self.logger.error(f"Failed to start module {module_name}")\n                self.state = SystemState.ERROR\n                return False\n\n            # Wait for module to start\n            time.sleep(3)\n\n            # Check health\n            if not self.check_health(module_name):\n                self.logger.error(f"Module {module_name} failed health check")\n                self.state = SystemState.ERROR\n                return False\n\n        self.state = SystemState.RUNNING\n        self.logger.info("Capstone system started successfully")\n        return True\n\n    def stop_system(self) -> bool:\n        """Stop the entire system."""\n        if self.state != SystemState.RUNNING:\n            self.logger.error("System is not in RUNNING state")\n            return False\n\n        self.state = SystemState.STOPPING\n        self.logger.info("Stopping capstone system...")\n\n        # Stop modules in reverse dependency order\n        startup_order = self._determine_startup_order()\n        shutdown_order = list(reversed(startup_order))\n\n        for module_name in shutdown_order:\n            if module_name in self.module_processes:\n                self.logger.info(f"Stopping module: {module_name}")\n                if not self.stop_module(module_name):\n                    self.logger.error(f"Failed to stop module {module_name}")\n                    # Continue with other modules even if one fails\n\n        self.state = SystemState.STOPPED\n        self.logger.info("Capstone system stopped")\n        return True\n\n    def _determine_startup_order(self) -> List[str]:\n        """Determine startup order based on dependencies."""\n        # Simple topological sort for dependency resolution\n        visited = set()\n        order = []\n\n        def visit(node):\n            if node in visited:\n                return\n            visited.add(node)\n\n            module = self.modules[node]\n            for dep in module.dependencies:\n                if dep in self.modules:\n                    visit(dep)\n\n            order.append(node)\n\n        for module_name in self.modules:\n            visit(module_name)\n\n        return order\n\n    def get_system_status(self) -> Dict[str, Any]:\n        """Get comprehensive system status."""\n        module_status = {}\n\n        for name, module in self.modules.items():\n            is_running = name in self.module_processes\n            health = self.health_status.get(name, False)\n\n            module_status[name] = {\n                "type": module.type.value,\n                "running": is_running,\n                "healthy": health,\n                "dependencies": module.dependencies\n            }\n\n        return {\n            "system_state": self.state.value,\n            "modules": module_status,\n            "startup_order": self._determine_startup_order(),\n            "error_count": len(self.error_log)\n        }\n\n    def run_health_monitor(self, interval: float = 30.0) -> None:\n        """Run continuous health monitoring in a separate thread."""\n        def monitor():\n            while self.state in [SystemState.RUNNING]:\n                for module_name in self.modules:\n                    self.check_health(module_name)\n\n                time.sleep(interval)\n\n        monitor_thread = threading.Thread(target=monitor, daemon=True)\n        monitor_thread.start()\n        self.logger.info("Health monitoring started")\n\n# Example usage\ndef example_capstone_implementation():\n    """Example of implementing the capstone system."""\n\n    # Create system instance\n    system = CapstoneSystem()\n\n    # Add modules (in a real implementation, these would be actual commands)\n    modules = [\n        SystemModule(\n            name="ros2_core",\n            type=ModuleType.ROS2,\n            startup_cmd="ros2 run demo_nodes_cpp talker",\n            health_check="ros2 node list | grep talker",\n            dependencies=[]\n        ),\n        SystemModule(\n            name="isaac_perception",\n            type=ModuleType.ISAAC,\n            startup_cmd="isaac-sim --config perception_config.yaml",\n            health_check="nvidia-smi | grep -q \'used\'",\n            dependencies=["ros2_core"]\n        ),\n        SystemModule(\n            name="vla_processing",\n            type=ModuleType.VLA,\n            startup_cmd="python3 vla_processor.py",\n            health_check="pgrep -f vla_processor",\n            dependencies=["isaac_perception"]\n        ),\n        SystemModule(\n            name="simulation_env",\n            type=ModuleType.SIMULATION,\n            startup_cmd="gazebo warehouse_world.world",\n            health_check="pgrep -f gazebo",\n            dependencies=["ros2_core"]\n        )\n    ]\n\n    for module in modules:\n        system.add_module(module)\n\n    # Get system status before starting\n    print("System status before start:")\n    status = system.get_system_status()\n    print(json.dumps(status, indent=2))\n\n    # Start the system\n    print("\\nStarting system...")\n    if system.start_system():\n        print("System started successfully")\n\n        # Get status after start\n        print("\\nSystem status after start:")\n        status = system.get_system_status()\n        print(json.dumps(status, indent=2))\n\n        # Run health monitor\n        system.run_health_monitor(10)  # Check every 10 seconds\n\n        # Simulate running for a while\n        time.sleep(5)\n\n        # Stop the system\n        print("\\nStopping system...")\n        system.stop_system()\n\n        print("System stopped")\n    else:\n        print("Failed to start system")\n\nif __name__ == "__main__":\n    example_capstone_implementation()\n'})}),"\n",(0,o.jsx)(n.h3,{id:"tutorial-2-implementing-ros2-integration-layer",children:"Tutorial 2: Implementing ROS2 Integration Layer"}),"\n",(0,o.jsx)(n.p,{children:"Let's create the ROS2 integration layer for our system:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\nfrom sensor_msgs.msg import Image, LaserScan, JointState\nfrom geometry_msgs.msg import Twist, PoseStamped\nfrom nav_msgs.msg import Odometry\nfrom std_msgs.msg import String\nfrom std_srvs.srv import Empty, SetBool\nfrom builtin_interfaces.msg import Time\nimport cv2\nimport numpy as np\nfrom typing import Dict, Any, Optional\nimport threading\n\nclass ROS2IntegrationNode(Node):\n    \"\"\"ROS2 node that integrates with other system components.\"\"\"\n\n    def __init__(self):\n        super().__init__('capstone_ros2_integration')\n\n        # QoS profiles\n        self.qos_profile = QoSProfile(\n            reliability=ReliabilityPolicy.BEST_EFFORT,\n            history=HistoryPolicy.KEEP_LAST,\n            depth=1\n        )\n\n        # Publishers\n        self.cmd_vel_pub = self.create_publisher(Twist, '/cmd_vel', 10)\n        self.nav_goal_pub = self.create_publisher(PoseStamped, '/goal_pose', 10)\n\n        # Subscribers\n        self.image_sub = self.create_subscription(\n            Image, '/camera/rgb/image_raw', self.image_callback, self.qos_profile\n        )\n        self.laser_sub = self.create_subscription(\n            LaserScan, '/scan', self.laser_callback, self.qos_profile\n        )\n        self.odom_sub = self.create_subscription(\n            Odometry, '/odom', self.odom_callback, 10\n        )\n        self.joint_state_sub = self.create_subscription(\n            JointState, '/joint_states', self.joint_state_callback, 10\n        )\n\n        # Services\n        self.reset_localization_srv = self.create_service(\n            Empty, 'reset_localization', self.reset_localization_callback\n        )\n        self.emergency_stop_srv = self.create_service(\n            SetBool, 'emergency_stop', self.emergency_stop_callback\n        )\n\n        # Internal state\n        self.latest_image = None\n        self.latest_laser = None\n        self.latest_odom = None\n        self.latest_joint_state = None\n        self.emergency_stopped = False\n\n        # Integration callbacks from other modules\n        self.isaac_callbacks = []\n        self.vla_callbacks = []\n        self.simulation_callbacks = []\n\n        self.get_logger().info('ROS2 Integration Node initialized')\n\n    def add_isaac_callback(self, callback: Callable) -> None:\n        \"\"\"Add callback for Isaac integration.\"\"\"\n        self.isaac_callbacks.append(callback)\n\n    def add_vla_callback(self, callback: Callable) -> None:\n        \"\"\"Add callback for VLA integration.\"\"\"\n        self.vla_callbacks.append(callback)\n\n    def add_simulation_callback(self, callback: Callable) -> None:\n        \"\"\"Add callback for simulation integration.\"\"\"\n        self.simulation_callbacks.append(callback)\n\n    def image_callback(self, msg: Image) -> None:\n        \"\"\"Handle incoming image messages.\"\"\"\n        self.latest_image = msg\n\n        # Convert ROS Image to OpenCV format\n        try:\n            # Assuming RGB8 encoding\n            if msg.encoding == 'rgb8':\n                image = np.frombuffer(msg.data, dtype=np.uint8)\n                image = image.reshape((msg.height, msg.width, 3))\n            elif msg.encoding == 'bgr8':\n                image = np.frombuffer(msg.data, dtype=np.uint8)\n                image = image.reshape((msg.height, msg.width, 3))\n                image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n            else:\n                self.get_logger().warn(f'Unsupported image encoding: {msg.encoding}')\n                return\n\n            # Call Isaac callbacks with image data\n            for callback in self.isaac_callbacks:\n                callback('image', image)\n\n        except Exception as e:\n            self.get_logger().error(f'Error processing image: {e}')\n\n    def laser_callback(self, msg: LaserScan) -> None:\n        \"\"\"Handle incoming laser scan messages.\"\"\"\n        self.latest_laser = msg\n\n        # Process laser data\n        ranges = np.array(msg.ranges)\n        # Replace invalid ranges with max range\n        ranges[np.isnan(ranges) | np.isinf(ranges)] = msg.range_max\n\n        # Call Isaac callbacks with laser data\n        for callback in self.isaac_callbacks:\n            callback('laser', ranges)\n\n    def odom_callback(self, msg: Odometry) -> None:\n        \"\"\"Handle incoming odometry messages.\"\"\"\n        self.latest_odom = msg\n\n        # Extract position and orientation\n        pose = {\n            'x': msg.pose.pose.position.x,\n            'y': msg.pose.pose.position.y,\n            'z': msg.pose.pose.position.z,\n            'qx': msg.pose.pose.orientation.x,\n            'qy': msg.pose.pose.orientation.y,\n            'qz': msg.pose.pose.orientation.z,\n            'qw': msg.pose.pose.orientation.w\n        }\n\n        # Call Isaac and VLA callbacks with pose data\n        for callback in self.isaac_callbacks:\n            callback('pose', pose)\n        for callback in self.vla_callbacks:\n            callback('pose', pose)\n\n    def joint_state_callback(self, msg: JointState) -> None:\n        \"\"\"Handle incoming joint state messages.\"\"\"\n        self.latest_joint_state = msg\n\n        # Create joint state dictionary\n        joint_state = {}\n        for i, name in enumerate(msg.name):\n            if i < len(msg.position):\n                joint_state[name] = {\n                    'position': msg.position[i],\n                    'velocity': msg.velocity[i] if i < len(msg.velocity) else 0.0,\n                    'effort': msg.effort[i] if i < len(msg.effort) else 0.0\n                }\n\n        # Call Isaac callbacks with joint state data\n        for callback in self.isaac_callbacks:\n            callback('joint_state', joint_state)\n\n    def reset_localization_callback(self, request: Empty.Request,\n                                   response: Empty.Response) -> Empty.Response:\n        \"\"\"Handle localization reset request.\"\"\"\n        self.get_logger().info('Resetting localization')\n\n        # Reset odometry\n        self.latest_odom = None\n\n        # Call Isaac callbacks to reset localization\n        for callback in self.isaac_callbacks:\n            callback('reset_localization', {})\n\n        return response\n\n    def emergency_stop_callback(self, request: SetBool.Request,\n                               response: SetBool.Response) -> SetBool.Response:\n        \"\"\"Handle emergency stop request.\"\"\"\n        self.emergency_stopped = request.data\n        self.get_logger().info(f'Emergency stop: {self.emergency_stopped}')\n\n        if self.emergency_stopped:\n            # Stop the robot\n            stop_cmd = Twist()\n            self.cmd_vel_pub.publish(stop_cmd)\n\n        # Call all integration callbacks\n        for callback in self.isaac_callbacks + self.vla_callbacks + self.simulation_callbacks:\n            callback('emergency_stop', {'stopped': self.emergency_stopped})\n\n        response.success = True\n        response.message = f'Emergency stop set to {self.emergency_stopped}'\n        return response\n\n    def send_navigation_goal(self, x: float, y: float, theta: float) -> None:\n        \"\"\"Send navigation goal to the system.\"\"\"\n        if self.emergency_stopped:\n            self.get_logger().warn('Cannot send navigation goal: emergency stopped')\n            return\n\n        goal = PoseStamped()\n        goal.header.stamp = self.get_clock().now().to_msg()\n        goal.header.frame_id = 'map'\n        goal.pose.position.x = x\n        goal.pose.position.y = y\n        goal.pose.position.z = 0.0\n\n        # Convert theta to quaternion\n        from math import sin, cos\n        goal.pose.orientation.z = sin(theta / 2.0)\n        goal.pose.orientation.w = cos(theta / 2.0)\n\n        self.nav_goal_pub.publish(goal)\n        self.get_logger().info(f'Sent navigation goal: ({x}, {y}, {theta})')\n\n    def send_velocity_command(self, linear: float, angular: float) -> None:\n        \"\"\"Send velocity command to the robot.\"\"\"\n        if self.emergency_stopped:\n            self.get_logger().warn('Cannot send velocity command: emergency stopped')\n            return\n\n        cmd = Twist()\n        cmd.linear.x = linear\n        cmd.angular.z = angular\n\n        self.cmd_vel_pub.publish(cmd)\n        self.get_logger().info(f'Sent velocity command: linear={linear}, angular={angular}')\n\ndef run_ros2_integration():\n    \"\"\"Run the ROS2 integration node.\"\"\"\n    rclpy.init()\n\n    node = ROS2IntegrationNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    run_ros2_integration()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"code-snippets",children:"Code Snippets"}),"\n",(0,o.jsx)(n.h3,{id:"performance-monitoring-and-optimization",children:"Performance Monitoring and Optimization"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# performance_monitor.py\nimport psutil\nimport time\nimport threading\nfrom typing import Dict, List, Any\nimport json\nfrom dataclasses import dataclass\n\n@dataclass\nclass PerformanceMetrics:\n    timestamp: float\n    cpu_percent: float\n    memory_percent: float\n    disk_usage: float\n    network_io: Dict[str, int]\n    process_count: int\n\nclass PerformanceMonitor:\n    """Monitor system performance during capstone implementation."""\n\n    def __init__(self, interval: float = 1.0):\n        self.interval = interval\n        self.metrics_history: List[PerformanceMetrics] = []\n        self.monitoring = False\n        self.monitor_thread = None\n\n    def start_monitoring(self) -> None:\n        """Start performance monitoring."""\n        self.monitoring = True\n        self.monitor_thread = threading.Thread(target=self._monitor_loop, daemon=True)\n        self.monitor_thread.start()\n\n    def stop_monitoring(self) -> None:\n        """Stop performance monitoring."""\n        self.monitoring = False\n        if self.monitor_thread:\n            self.monitor_thread.join()\n\n    def _monitor_loop(self) -> None:\n        """Main monitoring loop."""\n        while self.monitoring:\n            metrics = self._collect_metrics()\n            self.metrics_history.append(metrics)\n\n            # Keep only the last 1000 metrics to prevent memory issues\n            if len(self.metrics_history) > 1000:\n                self.metrics_history = self.metrics_history[-1000:]\n\n            time.sleep(self.interval)\n\n    def _collect_metrics(self) -> PerformanceMetrics:\n        """Collect current system metrics."""\n        # CPU usage\n        cpu_percent = psutil.cpu_percent(interval=None)\n\n        # Memory usage\n        memory = psutil.virtual_memory()\n        memory_percent = memory.percent\n\n        # Disk usage\n        disk_usage = psutil.disk_usage(\'/\').percent\n\n        # Network I/O\n        net_io = psutil.net_io_counters()\n        network_io = {\n            \'bytes_sent\': net_io.bytes_sent,\n            \'bytes_recv\': net_io.bytes_recv,\n            \'packets_sent\': net_io.packets_sent,\n            \'packets_recv\': net_io.packets_recv\n        }\n\n        # Process count\n        process_count = len(psutil.pids())\n\n        return PerformanceMetrics(\n            timestamp=time.time(),\n            cpu_percent=cpu_percent,\n            memory_percent=memory_percent,\n            disk_usage=disk_usage,\n            network_io=network_io,\n            process_count=process_count\n        )\n\n    def get_current_metrics(self) -> PerformanceMetrics:\n        """Get current performance metrics."""\n        return self._collect_metrics()\n\n    def get_average_metrics(self) -> Dict[str, float]:\n        """Get average metrics over the monitoring period."""\n        if not self.metrics_history:\n            return {}\n\n        avg_cpu = sum(m.cpu_percent for m in self.metrics_history) / len(self.metrics_history)\n        avg_memory = sum(m.memory_percent for m in self.metrics_history) / len(self.metrics_history)\n        avg_disk = sum(m.disk_usage for m in self.metrics_history) / len(self.metrics_history)\n\n        return {\n            \'avg_cpu_percent\': avg_cpu,\n            \'avg_memory_percent\': avg_memory,\n            \'avg_disk_usage\': avg_disk,\n            \'total_samples\': len(self.metrics_history)\n        }\n\n    def detect_performance_issues(self) -> List[str]:\n        """Detect potential performance issues."""\n        issues = []\n\n        if not self.metrics_history:\n            return issues\n\n        current = self.metrics_history[-1]\n\n        # Check for high CPU usage\n        if current.cpu_percent > 80:\n            issues.append(f"High CPU usage: {current.cpu_percent}%")\n\n        # Check for high memory usage\n        if current.memory_percent > 85:\n            issues.append(f"High memory usage: {current.memory_percent}%")\n\n        # Check for high disk usage\n        if current.disk_usage > 90:\n            issues.append(f"High disk usage: {current.disk_usage}%")\n\n        # Check for increasing memory usage (potential leak)\n        if len(self.metrics_history) > 10:\n            recent_memory = [m.memory_percent for m in self.metrics_history[-10:]]\n            if recent_memory[-1] > recent_memory[0] * 1.1:  # 10% increase\n                issues.append(f"Memory usage increasing: {recent_memory[0]:.1f}% -> {recent_memory[-1]:.1f}%")\n\n        return issues\n\n# Example usage\ndef example_performance_monitoring():\n    """Example of using performance monitoring in capstone implementation."""\n\n    monitor = PerformanceMonitor(interval=0.5)\n    monitor.start_monitoring()\n\n    print("Starting performance monitoring...")\n\n    # Simulate some work\n    for i in range(20):\n        time.sleep(1)\n\n        if i % 5 == 0:  # Check every 5 seconds\n            current = monitor.get_current_metrics()\n            print(f"CPU: {current.cpu_percent:.1f}%, Memory: {current.memory_percent:.1f}%")\n\n            issues = monitor.detect_performance_issues()\n            if issues:\n                print("Performance issues detected:")\n                for issue in issues:\n                    print(f"  - {issue}")\n\n    # Stop monitoring\n    monitor.stop_monitoring()\n\n    # Get average metrics\n    avg_metrics = monitor.get_average_metrics()\n    print(f"\\nAverage metrics: {json.dumps(avg_metrics, indent=2)}")\n\nif __name__ == "__main__":\n    example_performance_monitoring()\n'})}),"\n",(0,o.jsx)(n.h2,{id:"validation-and-testing",children:"Validation and Testing"}),"\n",(0,o.jsx)(n.h3,{id:"system-integration-testing",children:"System Integration Testing"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import unittest\nfrom unittest.mock import Mock, patch\nimport asyncio\n\nclass CapstoneSystemTester:\n    """Tester for the capstone integrated system."""\n\n    def __init__(self, system: CapstoneSystem):\n        self.system = system\n        self.test_results = []\n\n    def test_module_startup(self) -> Dict[str, Any]:\n        """Test that all modules start successfully."""\n        test_result = {\n            "test_name": "Module Startup",\n            "status": "pass",\n            "details": []\n        }\n\n        for module_name in self.system.modules:\n            if not self.system.start_module(module_name):\n                test_result["status"] = "fail"\n                test_result["details"].append(f"Module {module_name} failed to start")\n            else:\n                # Check health after startup\n                if not self.system.check_health(module_name):\n                    test_result["status"] = "fail"\n                    test_result["details"].append(f"Module {module_name} unhealthy after startup")\n\n        # Clean up: stop modules\n        for module_name in list(self.system.module_processes.keys()):\n            self.system.stop_module(module_name)\n\n        self.test_results.append(test_result)\n        return test_result\n\n    def test_system_startup_sequence(self) -> Dict[str, Any]:\n        """Test that the system starts with proper dependency order."""\n        test_result = {\n            "test_name": "System Startup Sequence",\n            "status": "pass",\n            "details": []\n        }\n\n        # Mock the start_module method to track order\n        original_start = self.system.start_module\n        start_order = []\n\n        def mock_start(module_name):\n            start_order.append(module_name)\n            # Call original method but return True for test\n            return True\n\n        self.system.start_module = mock_start\n\n        # Determine expected order\n        expected_order = self.system._determine_startup_order()\n\n        # Run startup (with mocked method)\n        self.system.state = SystemState.STARTING\n        for module_name in expected_order:\n            mock_start(module_name)\n\n        # Check if order matches expectations\n        if start_order != expected_order:\n            test_result["status"] = "fail"\n            test_result["details"].append(f"Startup order mismatch: expected {expected_order}, got {start_order}")\n\n        # Restore original method\n        self.system.start_module = original_start\n\n        self.test_results.append(test_result)\n        return test_result\n\n    def test_integration_points(self) -> Dict[str, Any]:\n        """Test that integration points work correctly."""\n        test_result = {\n            "test_name": "Integration Points",\n            "status": "pass",\n            "details": []\n        }\n\n        # This would test actual communication between modules\n        # For now, we\'ll simulate with mock tests\n        for ip_id in self.system.integration_points:\n            # Simulate integration point test\n            success = True  # In real implementation, this would test actual integration\n            if not success:\n                test_result["status"] = "fail"\n                test_result["details"].append(f"Integration point {ip_id} failed")\n\n        self.test_results.append(test_result)\n        return test_result\n\n    def test_error_handling(self) -> Dict[str, Any]:\n        """Test error handling mechanisms."""\n        test_result = {\n            "test_name": "Error Handling",\n            "status": "pass",\n            "details": []\n        }\n\n        # Test emergency stop functionality\n        try:\n            # This would test actual emergency stop behavior\n            # For simulation, we\'ll assume it works\n            pass\n        except Exception as e:\n            test_result["status"] = "fail"\n            test_result["details"].append(f"Error handling test failed: {e}")\n\n        self.test_results.append(test_result)\n        return test_result\n\n    def run_all_tests(self) -> Dict[str, Any]:\n        """Run all integration tests."""\n        results = {\n            "system_name": self.system.system_name,\n            "test_date": str(datetime.datetime.now()),\n            "tests_run": len(self.test_results),\n            "tests_passed": 0,\n            "tests_failed": 0,\n            "individual_results": []\n        }\n\n        # Run each test\n        tests = [\n            self.test_module_startup,\n            self.test_system_startup_sequence,\n            self.test_integration_points,\n            self.test_error_handling\n        ]\n\n        for test_func in tests:\n            result = test_func()\n            results["individual_results"].append(result)\n\n            if result["status"] == "pass":\n                results["tests_passed"] += 1\n            else:\n                results["tests_failed"] += 1\n\n        results["overall_status"] = "pass" if results["tests_failed"] == 0 else "fail"\n        results["pass_rate"] = results["tests_passed"] / len(tests) if tests else 0.0\n\n        return results\n\n# Example test run\ndef run_capstone_tests():\n    """Run comprehensive tests on the capstone implementation."""\n    # Create a test system\n    system = CapstoneSystem()\n\n    # Add some test modules\n    test_modules = [\n        SystemModule(\n            name="test_core",\n            type=ModuleType.ROS2,\n            startup_cmd="echo \'core started\'",\n            health_check="echo \'healthy\'",\n            dependencies=[]\n        ),\n        SystemModule(\n            name="test_perception",\n            type=ModuleType.ISAAC,\n            startup_cmd="echo \'perception started\'",\n            health_check="echo \'healthy\'",\n            dependencies=["test_core"]\n        )\n    ]\n\n    for module in test_modules:\n        system.add_module(module)\n\n    # Create tester\n    tester = CapstoneSystemTester(system)\n\n    # Run tests\n    results = tester.run_all_tests()\n\n    print("Capstone System Test Results:")\n    print(f"System: {results[\'system_name\']}")\n    print(f"Date: {results[\'test_date\']}")\n    print(f"Tests Run: {results[\'tests_run\']}")\n    print(f"Tests Passed: {results[\'tests_passed\']}")\n    print(f"Tests Failed: {results[\'tests_failed\']}")\n    print(f"Pass Rate: {results[\'pass_rate\']:.2%}")\n    print(f"Overall Status: {results[\'overall_status\']}")\n\n    print("\\nDetailed Results:")\n    for result in results["individual_results"]:\n        print(f"  {result[\'test_name\']}: {result[\'status\']}")\n        if result[\'details\']:\n            for detail in result[\'details\']:\n                print(f"    - {detail}")\n\nif __name__ == "__main__":\n    run_capstone_tests()\n'})}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(n.p,{children:"This chapter provided a comprehensive implementation guide for the capstone system, covering:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Implementation strategy for integrating multiple complex modules"}),"\n",(0,o.jsx)(n.li,{children:"Core system framework with module management and health monitoring"}),"\n",(0,o.jsx)(n.li,{children:"ROS2 integration layer with proper message handling and service interfaces"}),"\n",(0,o.jsx)(n.li,{children:"Performance monitoring and optimization techniques"}),"\n",(0,o.jsx)(n.li,{children:"System testing and validation approaches"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The practical tutorials demonstrated how to build a modular system framework, implement ROS2 integration with proper message handling, monitor system performance, and test the integrated system. We showed how to handle dependencies, manage system state, and implement error handling mechanisms."}),"\n",(0,o.jsx)(n.h2,{id:"mini-quiz",children:"Mini-Quiz"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"What is the purpose of the CapstoneSystem class in the implementation?"}),"\n",(0,o.jsx)(n.li,{children:"Why is it important to determine startup order based on dependencies?"}),"\n",(0,o.jsx)(n.li,{children:"How does the ROS2 integration node handle different message types?"}),"\n",(0,o.jsx)(n.li,{children:"What are the key components of the performance monitoring system?"}),"\n",(0,o.jsx)(n.li,{children:"What types of tests are important for validating an integrated system?"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"answers-to-mini-quiz",children:"Answers to Mini-Quiz"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"The CapstoneSystem class serves as the main orchestrator for the integrated system, managing the startup, shutdown, and health monitoring of all modules while respecting their dependencies."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Determining startup order based on dependencies ensures that modules are started in the correct sequence, preventing issues where a module tries to communicate with or use another module that hasn't been initialized yet."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"The ROS2 integration node handles different message types through dedicated callback functions (image_callback, laser_callback, etc.) that process the specific data format and distribute it to other system components through integration callbacks."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Key components of the performance monitoring system include CPU and memory usage tracking, disk usage monitoring, network I/O measurement, process counting, and issue detection algorithms."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Important tests for an integrated system include: module startup tests, system startup sequence tests, integration point tests, error handling tests, and performance validation tests."}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},2177:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/ch26-ad-f4f206c1a16324d468e2394786e8a3f2.svg"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(6540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);